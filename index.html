<!DOCTYPE html>
<html>
<head>
    <title>MCP Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>MCP Chatbot</h2>
    <input type="text" id="question" placeholder="Ask a question..." />
    <button onclick="askQuestion()">Ask</button>
    <div id="answer" style="margin-top:12px; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;"></div>

    <script>
        function renderTable(rows, limit = 20) {
            if (!Array.isArray(rows) || rows.length === 0) {
                return '<div style="color:#666">No results.</div>';
            }
            const headerKeys = Object.keys(rows[0] || {});
            const limited = rows.slice(0, limit);
            const thead = `<thead><tr>${headerKeys.map(k => `<th style="text-align:left; padding:6px 8px; border-bottom:1px solid #eee;">${k}</th>`).join('')}</tr></thead>`;
            const tbody = `<tbody>${limited.map(r => `<tr>${headerKeys.map(k => `<td style=\"padding:6px 8px; border-bottom:1px solid #f5f5f5; white-space:nowrap;\">${r[k] ?? ''}</td>`).join('')}</tr>`).join('')}</tbody>`;
            const note = rows.length > limit ? `<div style="color:#999; font-size:12px; margin-top:6px;">Showing first ${limit} of ${rows.length} rows.</div>` : '';
            return `<div><table style="border-collapse:collapse; font-size:14px;">${thead}${tbody}</table>${note}</div>`;
        }

        function askQuestion() {
            const question = $("#question").val().trim();
            if (!question) {
                $("#answer").html('<div style="color:#c00">Please enter a question.</div>');
                return;
            }
            $("#answer").html("Loading...");
            $.ajax({
                url: "/ask",
                method: "POST",
                data: { question },
                success: function(res) {
                    if (res && Array.isArray(res.data)) {
                        $("#answer").html(renderTable(res.data));
                    } else {
                        $("#answer").html('<div style="color:#666">No results.</div>');
                    }
                },
                error: function(xhr) {
                    let msg = "Request failed";
                    try {
                        const body = JSON.parse(xhr.responseText);
                        msg = body.error || msg;
                    } catch (_) {}
                    $("#answer").html(`<div style="color:#c00">${msg}</div>`);
                }
            });
        }
    </script>
</body>
</html>
